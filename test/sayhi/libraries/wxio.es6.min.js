!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.wxio=t()}(this,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(e){function t(){n(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Promise was canceled"));return e.name="CancelError",e}return o(t,e),t}(Error),u=function(){function e(t){var r=this;n(this,e),this._pending=!0,this._canceled=!1,this._promise=new Promise(function(e,n){return r._reject=n,t(function(e){r._cancel=e},function(t){r._pending=!1,e(t)},function(e){r._pending=!1,n(e)})})}return r(e,null,[{key:"fn",value:function(t){return function(){var n=[].slice.apply(arguments);return new e(function(e,r,o){n.unshift(e),t.apply(null,n).then(r,o)})}}}]),r(e,[{key:"then",value:function(){return this._promise.then.apply(this._promise,arguments)}},{key:"catch",value:function(){return this._promise.catch.apply(this._promise,arguments)}},{key:"cancel",value:function(){if(this._pending&&!this._canceled){if("function"==typeof this._cancel)try{this._cancel()}catch(e){this._reject(e)}this._canceled=!0,this._reject(new i)}}},{key:"canceled",get:function(){return this._canceled}}]),e}();Object.setPrototypeOf(u.prototype,Promise.prototype);var c=u,s=i;c.CancelError=s;var p=function(){function e(){n(this,e),this._queue=[]}return r(e,[{key:"enqueue",value:function(e,t){var n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)this._queue.push(n);else{var r=function(e,t,n){for(var r=0,o=e.length;o>0;){var a=o/2|0,i=r+a;n(e[i],t)<=0?(r=++i,o-=a+1):o=a}return r}(this._queue,n,function(e,t){return t.priority-e.priority});this._queue.splice(r,0,n)}}},{key:"dequeue",value:function(){return this._queue.shift().run}},{key:"size",get:function(){return this._queue.length}}]),e}(),S=function(){function e(r){if(n(this,e),!("number"==typeof(r=Object.assign({concurrency:1/0,autoStart:!0,queueClass:p},r)).concurrency&&r.concurrency>=1))throw new TypeError("Expected `concurrency` to be a number from 1 and up, got `"+r.concurrency+"` ("+t(r.concurrency)+")");this.queue=new r.queueClass,this._queueClass=r.queueClass,this._pendingCount=0,this._concurrency=r.concurrency,this._isPaused=!1===r.autoStart,this._resolveEmpty=function(){},this._resolveIdle=function(){}}return r(e,[{key:"_next",value:function(){this._pendingCount--,!this._isPaused&&this.queue.size>0?this.queue.dequeue()():(this._resolveEmpty(),0===this._pendingCount&&this._resolveIdle())}},{key:"add",value:function(e,t){var n=this;return new Promise(function(r,o){var a=function(){n._pendingCount++,e().then(function(e){r(e),n._next()},function(e){o(e),n._next()})};!n._isPaused&&n._pendingCount<n._concurrency?a():n.queue.enqueue(a,t)})}},{key:"addAll",value:function(e,t){var n=this;return Promise.all(e.map(function(e){return n.add(e,t)}))}},{key:"start",value:function(){if(this._isPaused)for(this._isPaused=!1;this.queue.size>0&&this._pendingCount<this._concurrency;)this.queue.dequeue()()}},{key:"pause",value:function(){this._isPaused=!0}},{key:"clear",value:function(){this.queue=new this._queueClass}},{key:"onEmpty",value:function(){var e=this;return 0===this.queue.size?Promise.resolve():new Promise(function(t){var n=e._resolveEmpty;e._resolveEmpty=function(){n(),t()}})}},{key:"onIdle",value:function(){var e=this;return 0===this._pendingCount?Promise.resolve():new Promise(function(t){var n=e._resolveIdle;e._resolveIdle=function(){n(),t()}})}},{key:"size",get:function(){return this.queue.size}},{key:"pending",get:function(){return this._pendingCount}},{key:"isPaused",get:function(){return this._isPaused}}]),e}(),C=e(function(e){e.exports=function(e,t){return t=t||function(){},e.then(function(e){return new Promise(function(e){e(t())}).then(function(){return e})},function(e){return new Promise(function(e){e(t())}).then(function(){throw e})})}}),l=e(function(e){var t=function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="TimeoutError",r}return o(t,e),t}(Error);e.exports=function(e,n,r){return new Promise(function(o,a){if("number"!=typeof n||n<0)throw new TypeError("Expected `ms` to be a positive number");var i=setTimeout(function(){if("function"!=typeof r){var i="string"==typeof r?r:"Promise timed out after "+n+" milliseconds",u=r instanceof Error?r:new t(i);"function"==typeof e.cancel&&e.cancel(),a(u)}else try{o(r())}catch(u){a(u)}},n);C(e.then(o,a),function(){clearTimeout(i)})})},e.exports.TimeoutError=t}),f=(l.TimeoutError,function(e){return!("object"!==(void 0===e?"undefined":t(e))||null===e||e instanceof RegExp||e instanceof Error||e instanceof Date)}),N={wx:wx},h={ASYNC:Symbol("ASYNC"),EVENT:Symbol("EVENT"),SYNC:Symbol("SYNC")},d=function e(t,n,r,o){if(r=Object.assign({deep:!1,target:{}},r),(o=o||new WeakMap).has(t))return o.get(t);o.set(t,r.target);var a=r.target;delete r.target;var i=!0,u=!1,c=void 0;try{for(var s,p=Object.keys(t)[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var S=s.value,C=t[S],l=n(S,C,t),N=l[1];r.deep&&f(N)&&(N=Array.isArray(N)?N.map(function(t){return f(t)?e(t,n,r,o):t}):e(N,n,r,o)),a[l[0]]=N}}catch(e){u=!0,c=e}finally{try{!i&&p.return&&p.return()}finally{if(u)throw c}}return a}({wx:{request:{pattern:h.ASYNC},uploadFile:{pattern:h.ASYNC},downloadFile:{pattern:h.ASYNC},connectSocket:{pattern:h.ASYNC},onSocketOpen:{pattern:h.EVENT},onSocketError:{pattern:h.EVENT},sendSocketMessage:{pattern:h.ASYNC},onSocketMessage:{pattern:h.EVENT},closeSocket:{pattern:h.ASYNC},onSocketClose:{pattern:h.EVENT},chooseImage:{pattern:h.ASYNC},previewImage:{pattern:h.ASYNC},getImageInfo:{pattern:h.ASYNC},saveImageToPhotosAlbum:{pattern:h.ASYNC},startRecord:{pattern:h.ASYNC},stopRecord:{pattern:h.SYNC},getRecorderManager:{pattern:h.SYNC},playVoice:{pattern:h.ASYNC},pauseVoice:{pattern:h.SYNC},stopVoice:{pattern:h.SYNC},getBackgroundAudioPlayerState:{pattern:h.ASYNC},playBackgroundAudio:{pattern:h.ASYNC},pauseBackgroundAudio:{pattern:h.SYNC},seekBackgroundAudio:{pattern:h.ASYNC},stopBackgroundAudio:{pattern:h.SYNC},onBackgroundAudioPlay:{pattern:h.EVENT},onBackgroundAudioPause:{pattern:h.EVENT},onBackgroundAudioStop:{pattern:h.EVENT},getBackgroundAudioManager:{pattern:h.SYNC},createAudioContext:{pattern:h.SYNC},createInnerAudioContext:{pattern:h.SYNC},chooseVideo:{pattern:h.ASYNC},saveVideoToPhotosAlbum:{pattern:h.ASYNC},createVideoContext:{pattern:h.SYNC},createCameraContext:{pattern:h.SYNC},saveFile:{pattern:h.ASYNC},getFileInfo:{pattern:h.ASYNC},getSavedFileList:{pattern:h.ASYNC},getSavedFileInfo:{pattern:h.ASYNC},removeSavedFile:{pattern:h.ASYNC},openDocument:{pattern:h.ASYNC},setStorage:{pattern:h.ASYNC},setStorageSync:{pattern:h.SYNC},getStorage:{pattern:h.ASYNC},getStorageSync:{pattern:h.SYNC},getStorageInfo:{pattern:h.ASYNC},getStorageInfoSync:{pattern:h.SYNC},removeStorage:{pattern:h.ASYNC},removeStorageSync:{pattern:h.SYNC},clearStorage:{pattern:h.SYNC},clearStorageSync:{pattern:h.SYNC},getLocation:{pattern:h.ASYNC},chooseLocation:{pattern:h.ASYNC},openLocation:{pattern:h.ASYNC},createMapContext:{pattern:h.SYNC},getSystemInfo:{pattern:h.ASYNC},getSystemInfoSync:{pattern:h.SYNC},canIUse:{pattern:h.SYNC},getNetworkType:{pattern:h.ASYNC},onNetworkStatusChange:{pattern:h.EVENT},onAccelerometerChange:{pattern:h.EVENT},startAccelerometer:{pattern:h.ASYNC},stopAccelerometer:{pattern:h.ASYNC},onCompassChange:{pattern:h.EVENT},startCompass:{pattern:h.ASYNC},stopCompass:{pattern:h.ASYNC},makePhoneCall:{pattern:h.SYNC},scanCode:{pattern:h.ASYNC},setClipboardData:{pattern:h.ASYNC},getClipboardData:{pattern:h.ASYNC},openBluetoothAdapter:{pattern:h.ASYNC},closeBluetoothAdapter:{pattern:h.ASYNC},getBluetoothAdapterState:{pattern:h.ASYNC},onBluetoothAdapterStateChange:{pattern:h.EVENT},startBluetoothDevicesDiscovery:{pattern:h.ASYNC},stopBluetoothDevicesDiscovery:{pattern:h.ASYNC},getBluetoothDevices:{pattern:h.ASYNC},getConnectedBluetoothDevices:{pattern:h.ASYNC},onBluetoothDeviceFound:{pattern:h.EVENT},createBLEConnection:{pattern:h.ASYNC},closeBLEConnection:{pattern:h.ASYNC},getBLEDeviceServices:{pattern:h.ASYNC},getBLEDeviceCharacteristics:{pattern:h.ASYNC},readBLECharacteristicValue:{pattern:h.ASYNC},writeBLECharacteristicValue:{pattern:h.ASYNC},notifyBLECharacteristicValueChange:{pattern:h.ASYNC},onBLEConnectionStateChange:{pattern:h.EVENT},onBLECharacteristicValueChange:{pattern:h.EVENT},startBeaconDiscovery:{pattern:h.ASYNC},stopBeaconDiscovery:{pattern:h.ASYNC},getBeacons:{pattern:h.ASYNC},onBeaconUpdate:{pattern:h.EVENT},onBeaconServiceChange:{pattern:h.EVENT},setScreenBrightness:{pattern:h.ASYNC},getScreenBrightness:{pattern:h.ASYNC},setKeepScreenOn:{pattern:h.ASYNC},onUserCaptureScreen:{pattern:h.EVENT},vibrateLong:{pattern:h.ASYNC},vibrateShort:{pattern:h.ASYNC},addPhoneContact:{pattern:h.ASYNC},showToast:{pattern:h.ASYNC},showLoading:{pattern:h.ASYNC},hideToast:{pattern:h.SYNC},hideLoading:{pattern:h.SYNC},showModal:{pattern:h.ASYNC},showActionSheet:{pattern:h.ASYNC},setNavigationBarTitle:{pattern:h.ASYNC},showNavigationBarLoading:{pattern:h.SYNC},hideNavigationBarLoading:{pattern:h.SYNC},setNavigationBarColor:{pattern:h.ASYNC},setTopBarText:{pattern:h.ASYNC},navigateTo:{pattern:h.ASYNC},redirectTo:{pattern:h.ASYNC},switchTab:{pattern:h.ASYNC},navigateBack:{pattern:h.SYNC},reLaunch:{pattern:h.ASYNC},createAnimation:{pattern:h.SYNC},pageScrollTo:{pattern:h.SYNC},createCanvasContext:{pattern:h.SYNC},createContext:{pattern:h.SYNC},drawCanvas:{pattern:h.SYNC},canvasToTempFilePath:{pattern:h.ASYNC},startPullDownRefresh:{pattern:h.ASYNC},stopPullDownRefresh:{pattern:h.SYNC},createSelectorQuery:{pattern:h.SYNC},getExtConfig:{pattern:h.ASYNC},getExtConfigSync:{pattern:h.SYNC},login:{pattern:h.ASYNC},checkSession:{pattern:h.ASYNC},authorize:{pattern:h.ASYNC},getUserInfo:{pattern:h.ASYNC},requestPayment:{pattern:h.ASYNC},showShareMenu:{pattern:h.ASYNC},hideShareMenu:{pattern:h.ASYNC},updateShareMenu:{pattern:h.ASYNC},getShareInfo:{pattern:h.ASYNC},chooseAddress:{pattern:h.ASYNC},addCard:{pattern:h.ASYNC},openCard:{pattern:h.ASYNC},openSetting:{pattern:h.ASYNC},getSetting:{pattern:h.ASYNC},getWeRunData:{pattern:h.ASYNC},navigateToMiniProgram:{pattern:h.ASYNC},navigateBackMiniProgram:{pattern:h.ASYNC},chooseInvoiceTitle:{pattern:h.ASYNC},checkIsSupportSoterAuthentication:{pattern:h.ASYNC},startSoterAuthentication:{pattern:h.ASYNC},checkIsSoterEnrolledInDevice:{pattern:h.ASYNC},reportAnalytics:{pattern:h.SYNC},setEnableDebug:{pattern:h.ASYNC}}}.wx,function(e,t){switch(t.pattern){case h.SYNC:case h.EVENT:return[e,N.wx[e]];case h.ASYNC:return[e,function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new c(function(n,r,o){var a=e(Object.assign({},t,{success:function(){r.apply(void 0,arguments)},fail:function(e){return e&&e.errMsg?o(new Error(e.errMsg)):e instanceof Error?o(e):void o(new Error(e))}}));a&&"function"==typeof a.abort&&n(function(){return a.abort()})})}}(N.wx[e])];default:throw new Error("Invalid pattern.")}});return d.request=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;return function(){return l(e.apply(void 0,arguments),t)}}(d.request,6e4),d.request=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new S({concurrency:t});return function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];return n.add(function(){return e.apply(void 0,r)})}}(d.request,5),d});